
@{
    ViewBag.Title = "ParilaViewIntegration";
}

<div class="container">
    <br />
    <input class="form-control" id="DateRunReadingIntegration" type="month" value="@DateTime.Now.Month"/>
    <button id="RunReadingIntegration" class="btn btn-primary">Запустить интеграцию показаний ИПУ</button>
</div>
<br />
<div class="progress hidden">
    <div class="progress-bar" id="ResultRunReadingIntegration" role="progressbar" style="width: 0%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
</div>
<script>
    $(document).ready(function (e) {
        $("#RunReadingIntegration").click(function () {
            $.ajax({
                url: '/Counter/RunIntegration?Date=' + $("#DateRunReadingIntegration").val(),
                success: function (data) {
                    alert('Интеграция завершена');
                },
                error: function () {
                    alert('Ошибка интеграции');
                }
            });
        })
        $(".loader").addClass("hidden");
        var i = 0;
        ///Обновление показаний
        $("#RunReadingIntegration").click(function (e) {
            $("#ResultRunReadingIntegration").parent().removeClass("hidden");
            var intervalID = setInterval(function () {
                $.ajax({
                    url: '/Counter/GetProgress?Name=Integration',
                    success: function (data) {
                        i = data;
                    },
                    error: function () {
                        i = "Что то пошло не так. Обратитесь к администратору! Это ошибка связана с показанием процентов загрузки";
                    }
                });
                // Добавляем ноль в начало цифры, которые до 10
                $("#ResultRunReadingIntegration").css('width', i + '%');
                $("#ResultRunReadingIntegration").text(i + '%');
                if (i === 100) { clearInterval(intervalID); $("#ResultRunReadingIntegration").parent().addClass("hidden"); }
            }, 3000);
        })
    });
</script>

