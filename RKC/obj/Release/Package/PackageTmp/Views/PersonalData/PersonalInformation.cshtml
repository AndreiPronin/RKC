@model IEnumerable<DB.Model.PersonalInformations>
@{
    ViewBag.Title = "PersonalInformation";
    var Index = 0;
}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

    @if (Model.Count() > 0)
    {
<div class="container">
    <h3 class="text-center">Детальная информация по лицевому счету  @Model.FirstOrDefault().full_lic</h3>
    @if (Model.FirstOrDefault().ZAK != null)
    {
        <p class="text-center NullOrEmpty" > Лицевой счет закрыт </p>
    }
    <div class="col-md-12">
        <button id="CloseLock" name="@Model.FirstOrDefault().full_lic" class="btn btn-success">Закрыть страницу</button>
    </div>
    <div id="ResultSearchSave"></div>
</div>
    <div class="loader">
        <div class="inner one"></div>
        <div class="inner two"></div>
        <div class="inner three"></div>
    </div>
    <div class="row">
        @foreach (var Items in Model)
        {

            <div style="margin-top:10px;" class="card">
                <div class="card-header text-center">
                    <a href="/Counter/DetailedInformIPU?FULL_LIC=@Model.FirstOrDefault().full_lic.Trim()" target="_blank">
                        <input type="button" class="btn btn-primary" value="Приборы учета" />
                    </a>
                    <a href="/PersonalData/DetailedInformPersData?FULL_LIC=@Model.FirstOrDefault().full_lic.Trim()" target="_blank">
                        <input type="button" class="btn btn-primary PersData" value="Персональный данные" />
                    </a>
                </div>
                <hr />
                <div class="card-body field">
                    <div class="col-md-12">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label">Лицевой счет:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="LastName" class="form-control" value="@Items.full_lic" />
                                </div>
                                <label class="col-sm-4 col-form-label">Фамилия:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="FirstName" class="form-control " value="@Items.LastName" />
                                    @*<input type="date" readonly="readonly" id="INSTALLATIONDATE" class="form-control" value="@string.Format("{0:yyyy-MM-dd}", Items.MiddleName)" />*@
                                </div>
                                <label class="col-sm-4 col-form-label">Имя:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="MiddleName" class="form-control " value="@Items.FirstName" />
                                </div>
                                <label class="col-sm-4 col-form-label">Отчество:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="DateOfBirth" class="form-control " value="@Items.MiddleName" />
                                </div>
                                <label class="col-sm-4 col-form-label">Улица:</label>
                                <div class="col-sm-8">
                                    <textarea readonly="readonly" tabIndex="@Index@{Index++;}" id="PlaceOfBirth" class="form-control ">@Items.Street</textarea>
                                </div>
                                <label class="col-sm-4 col-form-label">Дом:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="SnilsNumber" class="form-control SnilsNumber" value="@Items.House" />
                                </div>
                                <label class="col-sm-4 col-form-label">Квартира:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.Flat" />
                                </div>
                                <label class="col-sm-4 col-form-label">Вид собственности:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.RoomType" />
                                </div>
                                <label class="col-sm-4 col-form-label">Количество человек:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.NumberPerson" />
                                </div>
                                <label class="col-sm-4 col-form-label">Площадь:</label>
                                <div class="col-sm-8">
                                    <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.Square" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="col-sm-4 col-form-label">Код ФИАС:</label>
                            <div class="col-sm-8">
                                <textarea readonly="readonly" tabIndex="@Index@{Index++;}" id="PlaceOfBirth" class="form-control ">@Items.Fias</textarea>

                            </div>
                            <label class="col-sm-4 col-form-label">els:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.els" />
                            </div>
                            <label class="col-sm-4 col-form-label">igku:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.igku" />
                            </div>
                            <div class="col-sm-12 text-center">
                                <p>Тариф</p>
                            </div>
                            <label class="col-sm-4 col-form-label">Отопление:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.TARIF2" />
                            </div>
                            <label class="col-sm-4 col-form-label">ГВС компонент ТЭ:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.TARIF3" />
                            </div>
                            <label class="col-sm-4 col-form-label">ГВС компонент ХВ:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.TARIF5" />
                            </div>
                            <div class="col-sm-12 text-center">
                                <p>Площадь помещений дома:</p>
                            </div>
                            <label class="col-sm-4 col-form-label">S жилых помещений:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.S_GIL" />
                            </div>
                            <label class="col-sm-4 col-form-label">S нежилых помещений:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.S_NEZ" />
                            </div>
                            <label class="col-sm-4 col-form-label">S общего имущества:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.S_OI" />
                            </div>
                            <label class="col-sm-4 col-form-label">в т.ч. не отапливаемая:</label>
                            <div class="col-sm-8">
                                <input type="text" readonly="readonly" tabIndex="@Index@{Index++;}" id="Inn" class="form-control Inn" value="@Items.S_NOTP" />
                            </div>
                        </div>
                        <hr />
                    </div>
                    <div style="font-weight:bold;" class="col-md-12 text-center"><p>Состояние расчётов: @ViewBag.StateCalc.Period.ToString("MMMM yyyy")</p></div>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Услуга</th>
                                <th scope="col">Вх. сальдо</th>
                                <th scope="col">Оплачено</th>
                                <th scope="col">Начислено, в т.ч. перерасчёт</th>
                                <th scope="col">Исх. сальдо:</th>
                                @*<th scope="col">Конечное сальдо:</th>*@
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="text-center" >
                                <th scope="row">ЖКУ:</th>
                                <td>@ViewBag.StateCalc.Dk</td>
                                <td>@ViewBag.StateCalc.Sp</td>
                                <td>@ViewBag.StateCalc.Sn</td>
                               
                                <td>@ViewBag.StateCalc.Tdk</td>
                            </tr>
                            <tr class="text-center">
                                <th scope="row">Пени:</th>
                                <td>@ViewBag.StateCalc.PENY_DK</td>
                                <td>@ViewBag.StateCalc.Peny</td>
                                <td>@ViewBag.StateCalc.Peny_SN</td>
                                <td>@ViewBag.StateCalc.Peny_tdk</td>
                            </tr>
                            <tr class="text-center">
                                <th scope="row">Итого:</th>
                                <td>@ViewBag.StateCalc.DkPeny_dk</td>
                                <td>@ViewBag.StateCalc.SpPeny</td>
                                <td>@ViewBag.StateCalc.SnPeny_SN</td>
                                
                                <td>@ViewBag.StateCalc.TdkPeny_tdk</td>
                            </tr>
                        </tbody>
                    </table>
                   
                    <div style="margin-top:20px;" class="col-md-12">
                        <div class="col-md-3">
                            <button class="btn btn-primary DownLoadHelpСalculation">Справка расчет</button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary PaymentHistory">История оплат</button>
                        </div>
                        <div class="col-md-3">
                            <input type="button" class="btn btn-primary ShowAllDocument" value="Документы" data-toggle="modal" data-target="#ShowAllDocumentModal" />
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary DownLoadReceipt">Квитанция</button>
                        </div>

                    </div>
                    
                </div>
                
            </div>
        break;
        }
    </div>
    }
    else
    {
        <div class="container">
            <h3 class="text-center"></h3>
            <h1 class="text-center NullOrEmpty">По лицевому счету @ViewBag.FULL_LIC ничего не найдено</h1>
            <div class="col-md-12 text-center">
                 <div class="col-md-12 text-center">
            <a href="/Counter/DetailedInformIPU?FULL_LIC=@ViewBag.FULL_LIC" target="_blank">
                <input type="button" class="btn btn-primary" value="Приборы учета" />
            </a>
            <a href="/PersonalData/DetailedInformPersData?FULL_LIC=@ViewBag.FULL_LIC.Trim()" target="_blank">
                <input type="button" class="btn btn-primary PersData" value="Персональный данные" />
            </a>
                     </div>
        </div>
            <div class="col-md-12">
                <button id="CloseLock" name="@ViewBag.FULL_LIC" class="btn btn-success">Закрыть страницу</button>
            </div>
            <div id="ResultSearchSave"></div>
        </div>

    }
<div id="ShowAllDocument"></div>
<input id="" value="@ViewBag.FULL_LIC" hidden />
<script>
    function Loader() {
        $(".loader").addClass("hidden");
    }
    $(document).ready(function (e) {
        $(".DownLoadHelpСalculation").click(function (e) {
            var Date = "@DateTime.Now.Date.ToString("yyyy-MM")";
            console.log(Date);
            $.confirm({
                title: 'Справка расчет',
                content: '' +
                    '<form action="" class="formName">' +
                    '<div class="form-group">' +
                    '<label>С какой даты</label>' +
                    '<input type="month" min="2017-01" value="2017-01" placeholder="" id="DateFrom" class="form-control" />' +
                    '<label>По какую даты</label>' +
                    '<input type="month" min="2017-01" value="'+Date+'" placeholder="" id="DateTo" class="form-control" />' +
                    '</div>' +
                    '</form>',
                buttons: {
                    "Скачать": function () {
                        $.ajax({
                            success: function (data) {
                                window.location = '/PersonalData/DownLoadHelpСalculation?FullLic=' + @ViewBag.FULL_LIC + '&DateFrom=' + $("#DateFrom").val() + '&DateTo=' + $("#DateTo").val();
                            },
                            error: function () {
                                alert("Что то пошло не так. Обратитесь к администратору");
                            }
                        });
                    },
                    "Просмотр": function () {
                        var datefrom = $("#DateFrom").val();
                        var dateto = $("#DateTo").val();
                        $.ajax({
                            success: function (data) {
                                window.open('/PersonalData/WatchHelpСalculation?FullLic=' + @ViewBag.FULL_LIC + '&DateFrom=' + datefrom + '&DateTo=' + dateto);
                            },
                            error: function () {
                                alert("Что то пошло не так. Обратитесь к администратору");
                            }
                        });
                    },
                    "Отмена": function () {

                    }
                }
            })
        });
        $(".DownLoadReceipt").click(function (e) {
            var Date = "@DateTime.Now.Date.AddMonths(-1).ToString("yyyy-MM")";
            var DateMax = "@DateTime.Now.AddMonths(-1).ToString("yyyy-MM")";
            console.log(DateMax);
            $.confirm({
                title: 'Справка расчет',
                content: '' +
                    '<form action="" class="formName">' +
                    '<div class="form-group">' +
                    '<label>С какой даты</label>' +
                    '<input type="month" min="2017-01" max="' + DateMax + '" value="' + Date + '" placeholder="" id="DateReceiptEnd" class="form-control" />' +
                    '<label>По какую даты</label>' +
                    '<input type="month" min="2017-01" max="' + DateMax + '" value="' + Date + '" placeholder="" id="DateReceiptStart" class="form-control" />' +
                    '</div>' +
                    '</form>',
                buttons: {
                    "Скачать": function () {
                        $.ajax({
                            success: function (data) {
                                window.location = '/PersonalData/DownLoadReceipt?FullLic=' + @ViewBag.FULL_LIC + '&DateStart=' + $("#DateReceiptStart").val()
                                    + '&DateEnd=' + $("#DateReceiptEnd").val();
                                
                            },
                            error: function () {
                                alert("Что то пошло не так. Обратитесь к администратору");
                            }
                        });
                    },
                    "Отмена": function () {

                    }
                }
            })
        });
        $(".AddDoc").click(function (e) {
            var formData = new FormData();
            formData.append('FileLoad', $(this).parent().find('.file')[0].files[0]);
            formData.append('NameFile', $(this).parent().find('.NameFileFile').val());
            formData.append('Lic', $(this).parent().find('.LicFile').val());
            formData.append('idPersData', $(this).parent().find('.idPersDataFile').val());
            formData.append('Fio', $(this).parent().find('.FioFile').val());
            if ($(this).parent().find('.NameFileFile').val() == '') {
                $(this).parent().find('.NameFileFile').addClass("Required");
            } else {
                $(this).parent().find('.NameFileFile').remove("Required");
                $.ajax({
                    url: "/PersonalData/SaveFile",
                    type: "POST",
                    data: formData,
                    async: true,
                    success: function (data) {
                        alert(data.result)
                    },
                    error: function (data) {
                        alert('Ошибка обратитесь к системному администратору!');
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            }
            return false;
        });
        $(".PaymentHistory").click(function (e) {
            var Date = "@DateTime.Now.Date.AddMonths(-1).ToString("yyyy-MM")";
            var DateMax = "@DateTime.Now.AddMonths(-1).ToString("yyyy-MM")";
            console.log(DateMax);
            $.confirm({
                title: 'История оплат',
                content: '' +
                    '<form action="" class="formName">' +
                    '</form>',
                buttons: {
                    "Просмотреть": function () {
                        window.open('/PersonalData/PaymentHistoryView?FullLic=' + @ViewBag.FULL_LIC,'_blank');
                    },
                    "Отмена": function () {

                    }
                }
            })
        });
        setTimeout(Loader, 1000);
        $("#CloseLock").click(function () {
            window.close();
        })
        $(".ShowAllDocument").click(function (e) {
            $(".loader").removeClass("hidden");
            $.ajax({
                url: '/PersonalData/ShowAllDocument?FullLic=' +@ViewBag.FULL_LIC,
                type: 'Get',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#ShowAllDocument").empty();
                    $("#ShowAllDocument").append(data);
                    $(".loader").addClass("hidden");
                },
                error: function () {
                    alert("Что то пошло не так. Обратитесь к администратору");
                }
            });

        })
    });
</script>

